---
title: "Implementing a rapid geographic range expansion - comparing behavioral flexibility between a rapid and non-rapid expander"
author:
- '[Logan CJ](http://CorinaLogan.com)^1,2^*'
- '[Lukas D](http://dieterlukas.mystrikingly.com)^1^'
output:
  html_document:
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: no
    code_folding: hide
  md_document:
    toc: yes
  word_document:
    toc: yes
    toc_depth: '5'
  pdf_document:
    keep_tex: yes
    latex_engine: xelatex
bibliography: MyLibrary.bib
csl: Peer-Community-Journal-PCI.csl
urlcolor: blue
header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}
- \usepackage{longtable} #set longtable = TRUE in kable() to have a long table break over multiple pages https://bookdown.org/yihui/bookdown/tables.html
#For posting final version at EcoEvoRxiv: replace pre-introduction with https://docs.google.com/document/d/1DtcfJ9zE6c5MawGJ2Uq94Pmav-TldhTTKDmaGMJYJ7I/edit?usp=sharing . The PCI templates are located at https://osf.io/hfdjc
---

```{r setup, include=FALSE}
library(knitr)
library(formatR)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70),tidy=TRUE) 
#Make code chunks wrap text so it doesn't go off the page when knitting to PDF

knitr::opts_chunk$set(echo=F, include=T, results='asis', warning=F, message=F) 
#sets global options to display code along with the results https://exeter-data-analytics.github.io/LitProg/r-markdown.html
#set echo=F for knitting to PDF (hide code), and echo=T for knitting to HTML (show code)
```

```{r cleanbib, include=FALSE, eval=F}
### make a bibtex file that has only the references cited in this rmd 
#load the Rmd file
Rmd <- readChar("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/gxpopbehaviorhabitatq1.Rmd",nchars=1e7)

#find all in text citations that start with @, but are preceded by a space
pattern <- "\\ @(.*?)\\ "
m <- regmatches(Rmd,gregexpr(pattern,Rmd))[[1]]
m

res<- gsub("\\ ","",m) #delete spaces
res<- gsub("\\]","",res) #delete ]
res<- gsub("\\;","",res) #delete ;
res<- gsub("\\,","",res) #delete ,
res<- gsub("\\.","",res) # delete .

#find all in text citations that start with @, but are preceded by a "["
pattern2 <- "\\[@(.*?)\\ "
m2 <- regmatches(Rmd,gregexpr(pattern2,Rmd))[[1]]
m2

res2<- gsub("\\[","",m2)
res2<- gsub("\\]","",res2)
res2<- gsub("\\]","",res2)
res2<- gsub("\\;","",res2)
res2<- gsub("\\,","",res2)
res2<- gsub("\\.","",res2)
res2<- gsub("\\ ","",res2)

#combine both patterns
allbibtexkeys<-c(res,res2)

#write to a new file and then clean it up manually
write(allbibtexkeys,file="gxpopbehaviorhabitatq1_bibtexkeys.txt")

#load the cleaned txt file
allbibtexkeys<-read.csv("gxpopbehaviorhabitatq1_bibtexkeys.txt")

#use bib2df to convert the bibliography file into a dataframe
install.packages("bib2df")
library(bib2df)

#load the bib from GitHub
df <- bib2df("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/MyLibrary.bib")

#remove the @ to match the entry in the bib file
allbibtexkeys2<- gsub("\\@","",allbibtexkeys[,1])

#filter the full bib to only keep the entries that are cited here
df_filtered<-df[df$BIBTEXKEY %in% allbibtexkeys2,]

#use bib2df to convert the data frame into the bibliography file that only contains the citations in this Rmd
df2bib(df_filtered, file = "xpopq1refs.bib", append = FALSE)
```


&nbsp;

**Affiliations:** 1) Max Planck Institute for Evolutionary Anthropology, 2) University of California Santa Barbara. *Corresponding author: corina_logan@eva.mpg.de

&nbsp;



&nbsp;

**This article began as a preregistration, which was pre-study peer reviewed and received an In Principle Recommendation of the [version](https://github.com/corinalogan/grackles/blob/master/Files/Preregistrations/gxpopbehaviorhabitatPassedPreStudyPeerReview16Dec2021.pdf) on 16 Dec 2021 by:**

Esther Sebastián González (2020) The role of behavior and habitat availability on species geographic expansion. *Peer Community in Ecology*, 100062. [10.24072/pci.ecology.100062](https://doi.org/10.24072/pci.ecology.100062). Reviewers: Caroline Nieberding, Tim Parker, and Pizza Ka Yee Chow


# ABSTRACT

It is generally thought that behavioral flexibility, the ability to change behavior when circumstances change, plays an important role in the ability of species to rapidly expand their geographic range. Great-tailed grackles (*Quiscalus mexicanus*; GTGR) and their closest relative, boat-tailed grackles (*Quiscalus major*; BTGR), are social, polygamous species, however the former are rapidly expanding their geographic range by settling in new areas and habitats, whereas the latter are not rapidly expanding their range and not settling in new habitats. We have previously found that GTGR are behaviorally flexible, however not much is known about BTGR behavior. This offers an opportunity to determine whether changes in behavioral traits facilitate the rapid GTGR expansion by comparing their behavioral flexibility with BTGR on the same tests. We compared behavioral flexibility of wild GTGR from two populations across their range (an older population in the middle of the northern expansion front: Tempe, Arizona, and a more recent population on the northern edge of the expansion front: Woodland, California) with wild BTGR from Lake Placid, Florida to investigate whether the rapidly expanding GTGR are more flexible. We found that both species have similar levels of flexibility (measured as the number of switches between food types during focal follows). Our results elucidated that, while GTGR are flexible, flexibility may not be the primary factor involved in their successful range expansion. If this were the case, we would expect to see a rapid range expansion in BTGR as well. This adds further support to our previous findings that persistence and flexibility variance play a larger role in the edge GTGR population. Our findings highlight the value of comparative studies and of breaking down cognitive concepts into direct measures of individual abilities to better understand how species might adapt to novel circumstances.

\newpage

# INTRODUCTION

It is generally thought that behavioral flexibility (hereafter, “flexibility”)  plays an important role in the ability of a species to rapidly expand their geographic range [e.g., @lefebvre1997feeding; @griffin2014innovation; @chow2016practice; @sol2000behavioural; @sol2002behavioural; @sol2005big; @sol2007big]. It is predicted that flexibility, the ability to change behavior when circumstances change through packaging information and making it available to other cognitive processes [see @mikhalevich_is_2017 for theoretical background on our flexibility definition], as well as exploration (latency to explore a novel environment or object) and innovation [creating new behaviors or using existing behaviors in a new context, @griffin2014innovation] facilitate the expansion of individuals into completely new areas. However, the role of these behaviors in the process of establishing a population in a particular area is predicted to diminish after a certain number of generations [@wright2010behavioral]. In support of this, experimental studies have shown that latent abilities are primarily expressed in a time of need [e.g., @taylor2007spontaneous; @bird2009insightful; @manrique2011spontaneous; @auersperg2012spontaneous; @laumer2018spontaneous].

To determine whether a behavior (e.g., flexibility, innovativeness, exploration, persistence) is involved in a rapid geographic range expansion, direct measures of behaviors in individuals must be collected in populations across the range of the species (see the discussion on the danger of proxies of flexibility in Logan et al., 2018). Flexibility, the ability to recognize that something about the environment has changed and decide to consider other options for deploying behavior [@mikhalevich_is_2017], is distinct from innovation, which is the specific stringing together of particular actions in a new way or in a new context [@griffin2014innovation]. Innovative behavior can be related to flexibility in that it may occur in response to the decision to change behavior in some way. Investigations of behavior in invasive species and species that are rapidly expanding their geographic ranges that compare edge versus core populations are rare. Behavioral evidence from invasive species indicates that Common mynas (*Sturnus tristis*) on the invasion front are more innovative than those from populations away from the front as well as those in their native range [@cohen2020innovation]. Similarly, spiders (*Cyrtophora citricola*) and bank voles (*Myodes glareolus*) from edge populations are less exploratory than those from core populations [@chuang2021personality; @eccard2022timid]. An increase in innovation in newly established populations could facilitate new foraging techniques and the ability to exploit new food sources [@griffin2016invading], while a decrease in exploration could reduce their risk of encountering danger in a new area. More data from more species is required to discover whether these results are generalizable to an invasion or rapid range expansion context. As such, it is important to decide which measures are the best proxies of the behavior in question. For example, exploration is often measured as activity levels [e.g., @fox_behavioural_2009; @logan2016behavioral], however it is important to distinguish activity levels, which could be an indicator of stress, from the curiosity to investigate novelty [@mettke2002significance]. The latter can be accomplished by placing a novel environment or object inside of the familiar environment, thus making it optional to approach the novel element. Additionally, we can distinguish exploration from boldness through variation in food deprivation or placement of food. For boldness, the behavioral response to a potential threat, subjects are usually food deprived and then a preferred food item is placed next to the novel object [@reale2007integrating]. Whereas, in exploration assays, the regular maintenance diet is provided far away from the novel element to assess the willingness to investigate novelty without the need for food [@mettke2002significance]. The latter ensures that the individual approaches the novel element primarily because they are internally motivated to explore something new.

Persistence behavior, “a measure of task-directed motivation” (Griffin & Guez 2014), to our knowledge, has not been investigated across populations of species that are rapidly expanding their geographic ranges. However, it could facilitate a range expansion through improving problem solving success [@morand2011innovators] and efficiency [@chow2016practice]. There is some indication that this could be the case in a cross-species comparison of Invasive mynas who were found to be more persistent than native noisy miners (*Manorina melanocephala*) even though both species are successful in urban environments [@griffin2015innovative]. Persistence is measured in a variety of ways [e.g., work time, number of touches to the test apparatus, number/frequency of unsuccessful manipulations, etc., see @griffin2014innovation for a review], which makes it a difficult variable to compare across studies. Many measures of persistence are resource intensive to collect because they involve hundreds of hours of video coding, which could prohibit some researchers from being able to measure this variable due to time and financial constraints. Therefore, we developed an easy to calculate measure that we believe better represents task-directed motivation in grackles: the number of trials participated in divided by the total number of trials offered.

We expect that the actual act of continuing a range expansion relies on flexibility, exploration, innovation, and persistence. It is therefore likely that these behaviors are expressed more on the edge of the expansion range where there have not been many generations to accumulate relevant knowledge about or genetic adaptations to the environment. Our study aims to test whether behavioral flexibility, innovativeness, exploration, and persistence play a role in the rapid geographic range expansion of great-tailed grackles (*Quiscalus mexicanus*). Great-tailed grackles are behaviorally flexible [@logan2016flexibilityproblem], rapidly expanding their geographic range [@wehtje2003range], and highly associated with human modified environments [@johnson2001great], thus offering an opportunity to assess the role of behavior across their expansion. This social, polygamous species eats a variety of human foods in addition to foraging on insects and on the ground for other natural food items [@johnson2001great]. This opportunistic foraging behavior increases the ecological relevance of comparative cognition experiments that measure individual behavior abilities: grackles eat at outdoor cafes, from garbage cans, and on crops, where they generally gain experience in the wild with approaching and opening novel objects to seek food (e.g., attempting to open a ketchup packet at an outdoor cafe, climbing into garbage cans to get french fries at the zoo, dunking sugar packets in water). Consequently, tests involving human-made apparatuses are ecologically relevant for this species. We compared behavior in wild-caught great-tailed grackles from two populations across their range. We use previously published data from @logan2023flexmanip for an older population in the middle of the northern expansion front in Tempe, Arizona, as well as new data collected on a more recent population on the northern edge of the expansion front in Woodland, California (Figure 1, Table 1). We investigated whether certain behaviors had higher averages and variances in the edge population relative to the older population. Specifically, we investigated behavioral flexibility, measured as reversal learning of food-filled colored tube preferences [@logan2016behavioral; @logan2023flexmanip]; innovativeness, measured as the number of loci they solve to access food from a puzzle box [@auersperg_flexibility_2011; @logan2023flexmanip]; exploration, measured as the latency in seconds to approach a novel environment in the absence of nearby food [@mccune2019exploration; @mettke2009spatial]; and persistence, measured as the proportion of trials they participated in during the flexibility and innovativeness experiments (Figure 2). While it is possible for individuals in the wild to learn asocially and socially about new foods or foraging techniques to assess whether the risks are low enough to encourage exploration behavior, we focused on measuring these four behaviors in an asocial context to allow us to obtain the individual’s actual cognitive performance (i.e., in the absence of dominant individuals who might hinder subordinates from participating). There could be multiple mechanisms underpinning the results, however our aim was to narrow down the role of changes in behavior in the range expansion of great-tailed grackles. 


# RESEARCH QUESTION: Are there differences in behavioral traits (flexibility, innovation, exploration, and persistence) between boat-tailed and great-tailed grackles?  (Fig 2)**

**Prediction 6:** If behavior modifications are needed to adapt to new locations, then great-tailed grackles, which are rapidly expanding their geographic range [@wehtje2003range], will have higher averages and/or larger variances than boat-tailed grackles, which are not rapidly expanding their range [@post1996boat, @wehtje2003range], in at least some behavioral traits (behavioral flexibility: speed at reversing a previously learned color preference, innovativeness: number of options solved on a puzzle box, exploration: latency to approach/touch a novel object, and persistence: proportion of trials participated in). Higher averages in behavioral traits indicate that each individual can exhibit more of that trait. If resources are regularly dispersed in time and space, perhaps boat-tailed grackles require less flexibility when visiting these resources and attend less to their temporal availability or the individual's food preferences. Perhaps the problems boat-tailed grackles solve do not require much exploration or persistence. Lower variances in behavioral traits indicate that there is less diversity of individuals in the population, which means that there is a lower chance that some individuals in the population would innovate new foraging techniques and be more flexible, exploratory, and persistent.

**Prediction 6 alternative 1:** Human-modified environments are suitable habitat for great-tailed and boat-tailed grackles and the amount of human-modified environments has and is increasing. If the original behaviors exhibited by these species happen to be suited to the uniformity of human-modified landscapes, then averages and/or variances of these traits will be similar in the great-tailed and boat-tailed grackles sampled. This supports the hypothesis that, because these species are closely associated with human-modified environments [@johnson2001great, @wehtje2003range], which may be similar across the geographic range, individuals in new areas may not need to learn very much about their new environment: they can eat familiar foods and access these foods in similar ways across their range (e.g., fast food restaurant chains likely make the same food and package it in the same packaging in Central and North America, outdoor cafes and garbage cans also look the same across their range).

**Prediction 6 alternative 2:** If boat-tailed grackles have higher averages and/or larger variances in the behavioral traits measured, this could indicate that perhaps these traits are not the primary facilitators of the great-tailed grackle's rapid geographic range expansion. Alternatively, perhaps these species differ in a life history variable that restricts the boat-tailed grackle from expanding, or there is some geographic feature that prevents the boat-tailed grackle from rapidly expanding its range (see Q3).


# METHODS

# Sample

Great-tailed grackles were caught in the wild in Woodland and in the Bufferlands of Sacramento, California. Some of our banded individuals were found in Woodland and the Bufferlands, which are 32 km apart, therefore we considered this one population. We caught grackles with walk-in traps and mist nets. Mist nets decrease the likelihood of a selection bias for exploratory and bold individuals because grackles cannot see the trap. We aimed to bring adult grackles, rather than juveniles, temporarily into the aviaries for behavioral choice tests to avoid the potential confound of variation in cognitive development due to age, as well as potential variation in fine motor-skill development [e.g., early-life experience plays a role in the development of holding/grasping objects, @collias1964development; @rutz2016discovery] with variation in our target variables of interest. Observations from members of the Yolo Audubon Society in Woodland, Davis, and Sacramento, California suggest that movement into new areas is most likely by adults or groups of mixed age individuals (Yolo Audubon Society’s newsletter *The Burrowing Owl*). Accordingly, if there are differences associated with presence at the edge of the rane, these differences should also be expressed in adults. Adults were identified from their eye color, which changes from brown to yellow upon reaching adulthood [@johnson2001great]. However, due to difficulties in trapping this species at this site, we also tested some juveniles. This should not pose a problem because we found that the two juveniles (Taco and Chilaquile) we tested in the Tempe population did not perform differently from adults [@logan2023flexmanip; @blaisdell2021causal; @logan2021inhibition; @seitz2021touchscreentraining]. We applied colored leg bands in unique combinations for individual identification. Some individuals (n=33 in Woodland) were brought temporarily into aviaries for behavioral choice tests, and then released back to the wild at their point of capture. Grackles were individually housed in an aviary (each 244 cm long by 122 cm wide by 213 cm tall) for 3 weeks to 6 months where they had *ad lib* access to water at all times and were fed Mazuri Small Bird maintenance diet *ad lib* during non-testing hours (minimum 20 h per day), and various other food items (e.g., peanuts, bread) during testing (up to 4 h per day per bird). Individuals were given three to four days to habituate to the aviaries and then their test battery began on the fourth or fifth day (birds were usually tested six days per week, therefore if their fourth day occurred on a day off, they were tested on the fifth day instead). 

We tested as many great-tailed grackles as we could during the 2 years we spent at each of our field sites given that the birds were only brought into the aviaries during the non-breeding season (September through April). It is time intensive to conduct the aviary test battery (3 weeks-6 months per bird), therefore we aimed to meet the minimum sample sizes in Supplementary Material 1 and 2. We aimed for an equal sex ratio of subjects (50% female) and achieved an overall 47% female (this percentage differed depending on the test). We expected to test 20 grackles per site. See the gxpopbehaviorhabitat_data_testhistory.csv data sheet at @logan2023xpopdata for a list of the order of experiments for each individual at the Woodland site, and g_flexmanip_data_AllGrackleExpOrder.csv at @logan2023flexmanipdata for the Tempe grackles.We stopped collecting data on wild-caught great-tailed grackles once we met our minimum sample size (Supplementary Material 1 and 2).

## Protocol

The Flexibility protocol [from @logan2024flexfor] used switching between food types during focal follows [@altmann1974observational]. 10 min focal follows were conducted in which all foraging techniques and all food types were recorded, as well as the foraging bout start and end times. Data were collected using a voice recorder (Voice Memos app on an iPhone) and later transcribing the recording into the datasheet on the computer. We set the minimum sample size to the average number of focals obtained from the great-tailed grackles [@logan2024flexfor]: a minimum of 4 focals per bird (conducted on separate days between 09:00 and 16:00, attempting to counterbalance mornings and afternoons). We set the minimum sample size for the number of individuals to 8, which was the number of great-tailed grackles in the flexibility manipulated condition in [@logan2024flexfor]. The full experimental protocol, including ethogram, is online at: https://docs.google.com/document/d/1WK6oR04LR1Q2CGXgICvUNN28MWlM-3o2U66lanDv-lc/edit?usp=sharing.

## Statistical analyses

We used **simulations** and designed **customized models** to determine what sample sizes would allow us to detect differences between sites following the methods in @rethinking2020 [Supplementary Material 1 and 2; see chapter 5.3 in @bolker2008ecological for why simulations perform more powerful power analyses]. We did not **exclude** any data, and if data were **missing** (e.g., if a bird participated in only one of the two experiments) for an individual in a given experiment, then this individual was not included in that analysis. Analyses were conducted in R [current version `r getRversion(), @rcoreteam] and Stan [version 2.18, @carpenter2017stan] using the following packages: psych [@psych] and irr [@gamer2012package] for calculating interobserver reliability scores; rethinking [@rethinking2020], cmdstanr [@cmdstanr], rstan [@rstan], posterior [@posterior] and Rcpp [@rcpp] for conducting Bayesian analyses; knitr [@xie2018knitr; @xie2017dynamic; @xie2013knitr], formatR [@formatr], dplyr [@dplyr], tidyr [@tidyr], kableExtra [@kableextra], lattice [@Sarkar2008], and gridExtra [@gridExtra] for formatting; DHARMa [@hartig2019dharma] for data cleaning; lme4 [@lme4; @bates2012lme4] and MCMCglmm [@hadfield2010mcmc] for running GLMMs; and rptR [@stoffel2017rptr] for calculating repeatability. Interobserver reliability scores indicated high agreement across coders for all dependent variables (see Supplementary Material 3 for details).

### Flexibility analysis

For each focal follow, we calculated the number of switches between food types that occur and the total amount of time that the bird was observed. We sum both measures across focal follows to have one data point per bird. This model takes the form of:

$foodswitches_{i}$ ~ Binomial($totaltime_{i}$, $p$) *[likelihood]*,

logit($p$) ~ $\alpha_{i}$[$population$] *[model]*,

where $foodswitches_{i}$ is the number of times individual, i, changed food types across all of their focal follows, $totaltime_{i}$ is the number of seconds individual, i, was observed across all of its focal follows, $p$ is the probability of switching to a different food type per second, and $\alpha_{i}$ is the intercept (one per level of $population$: AZ GTGR, CA GTGR, BTGR).


## Updates made to the in principle recommendation

This study began as a preregistration that was peer reviewed and received in principle recommendation at PCI Ecology in 2020 [@logan2023xpop]. While our ideal plan was to conduct the same tests in boat-tailed grackles as we did in great-tailed grackles (reversal learning, innovativeness, persistence, and exploration), due to two adult males dying in the aviaries, we decided not to continue with aviary research for this species. We received permission from our recommender, Esther Sebastián González, in February 2023 to replace the aviary tests with the one test we were able to conduct using the same methods in the wild - reversal learning using automated feeders.

In September 2023, before the new set of data collection started, it was becoming clear that the automated feeders that were designed for us might not function well enough to be used in an experiment. Therefore, we received permission from our recommender, Esther Sebastián González, in September 2023 to add an additional measure of behavioral flexibility that we had recently discovered in the great-tailed grackles: switching between food types during focal follows [@logan2024flexfor].

After data collection started in November 2023, and after extensive work in trying to get the automated feeders to function, we discovered in January 2024 that the feeders are not usable. Therefore, we have no data on reversal learning.



# RESULTS



See Table 2 for summary results for grackles in Woodland and Tempe, as well as some data for boat-tailed grackles (population: BTGR), which we describe in the Discussion.

\blandscape
**Table 2.** Summary data by bird for each of the variables measured. Population indicates where they were trapped (Sacramento is part of the Woodland population), bird is the bird’s name, sex indicates whether they are female (F) or male (M), learn speed is the number of trials to form the initial color preference, reversal speed is the number of trials to reverse the color preference (first reversal), $\phi$ and $\lambda$ are the two flexibility components (from the first reversal), MAB loci are the number of loci solved on the multiaccess box, MAB max is the maximum number of loci available to that bird, Exploration is the average number of seconds it took the bird to approach within 20 cm of the novel environment (note that 2701 s means the bird never approached), persistence is the proportion of reversal learning and multiaccess box trials the bird participated in, and flexibility manipulated indicates whether this was one of the 8 Tempe grackles who underwent the serial reversals to make them more flexible (Yes) or not (No). “X” indicates that this bird did not complete this experiment or that we cannot count the data for this experiment, and “-” indicates this bird was not given this experiment.
```{r resltssummarytable, eval=T, warning=FALSE, results='asis', include=TRUE}
library(kableExtra)
library(dplyr)
sumtable <- read.csv(url("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/gxpopbehaviorhabitatq1dataSummaryCAAZ.csv"), header=T, sep=",", stringsAsFactors=F)
sumtable <- data.frame(sumtable)
colnames(sumtable) <- c("Population","Batch","ID","Bird","Sex","Learn","Reverse","Phi","Lambda","MABloci","MABmax","Exploration","Persistence","Flexibilitymanipulated","Notes")

# Only include certain columns
sumtable <- select(sumtable,Population,Bird,Sex,Learn,Reverse,Phi,Lambda,MABloci,MABmax,Exploration,Persistence,Flexibilitymanipulated)

# Rename columns for final table
colnames(sumtable) <- c("Population","Bird","Sex","Learn speed","Reverse speed","Phi","Lambda","MAB loci","MAB max","Exploration","Persistence","Flexibility manipulated")

knitr::kable(sumtable) %>%
kable_styling(full_width = T, position = "left",  bootstrap_options = "condensed", font_size = 6)
```
\elandscape


**Table 3.** Contrasts (indicated by "diff") between populations for the flexibility measure of reversal learning: $\phi$ and $\lambda$ (data from the first reversal).

```{r resltsflextable, eval=T, warning=FALSE, results='asis', include=TRUE}
library(kableExtra)
flextable <- read.csv(url("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/gxpopbehaviorhabitat_Table4.csv"), header=F, sep=",", stringsAsFactors=F)
flextable <- data.frame(flextable)
colnames(flextable) <- c("","Mean","Standard deviation","Lower 89 percentile compatibility interval (5.5%)","Upper 89 percentile compatibility interval (94.5%)")

knitr::kable(flextable) %>%
kable_styling(full_width = T, position = "left",  bootstrap_options = "condensed", font_size = 11)
```

The food type data set consisted of X individuals (6=manipulated, 7=control), and the foraging technique data set consisted of 12 individuals (n=5 manipulated, n=7 control) who had data that involved eating at least one food type

```{r xpopfoodswitches, eval=T, out.width="10cm",fig.align = "center", fig.cap="The probability of switching among food types per minute for boat-tailed grackles and great-tailed grackles (Arizona and California). The small circles are the data points per individual and the large circles are the estimated means with their 89% compatibility intervals represented by the vertical lines."}
### NUMBER OF FORAGING TECHNIQUES for flexibility manipulated vs control birds - did manipulated switch more?
library(rethinking)
library(dplyr)
ft <- read.csv(url("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/g_flexforaging_data_foraging.csv"), header=T, sep=",", stringsAsFactors=F)
ft <- data.frame(ft)

# FYI across AZ and CA populations...
#How many different food types?
#length(unique(ft$What)) #22
#unique(ft$What) #fry, lizard, unknown, grains, insect, rock, cat food, worm, seed, food crumbs, vegetation, fruit, bird poop, candy, vomit, misc. trash, soil, condiment, carcass, chicken, peanut, mulch

#How many different foraging techniques?
#length(unique(ft$How)) # 13 - 1 (eat) - 1 (tolerated theft) = 11
#unique(ft$How) #eat, gape, lift or nudge, stalk catch, flip, food share, break into pieces, dunk in water, tolerated theft, theft, dig, pick up, sweep


# ONLY AZ: select only the AZ birds who were manipulated or control individuals in the flexibility experiment
ft1 <- ft[ft$Population=="AZ",]

# AZ population: How many different food types?
#length(unique(ft1$What)) #20
#unique(ft1$What) #fry, lizard, unknown, grains, insect, rock, cat food, worm, seed, food crumbs, vegetation, fruit, bird poop, candy, vomit, misc. trash, soil, condiment, carcass, chicken

# AZ population: How many different foraging techniques?
#length(unique(ft1$How)) # 11 - 1 (eat) - 1 (tolerated theft) = 9
#unique(ft1$How) #eat, gape, lift or nudge, stalk catch, flip, food share, break into pieces, dunk in water, tolerated theft, theft, dig


#FOOD TYPES: count the number of technique switches during each focal
#exclude NAs from the variables in this model
fo <- subset(ft1, is.na(ft1$What) == FALSE)

#calculate food type switches per bird across all follows
fo$FoodSwitch<-NA
fo[1,]$FoodSwitch<-0
for(i in 2:nrow(fo)){
  ifelse(fo[i,]$FocalID==fo[i-1,]$FocalID & fo[i,]$What !=fo[i-1,]$What, fo[i,]$FoodSwitch<-1,fo[i,]$FoodSwitch<-0)
}

fo2 <- fo %>% group_by(BirdID,FocalID) %>% summarise(foodswitchesperfocal=sum(FoodSwitch),timeperfocal=mean(TotalTimeInView))
fo3 <- fo2 %>% group_by(BirdID) %>% summarise(totalfoodswitches=sum(foodswitchesperfocal),totaltime=sum(timeperfocal))

# link with general datasheet to identify which birds were manipulated
c1 <- read.csv(url("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/g_flexforaging_data_general.csv"), header=T, sep=",", stringsAsFactors=F)
c1 <- data.frame(c1)
#select only the AZ birds who were manipulated or control individuals in the flexibility experiment
c1 <- c1[c1$Population=="AZ",]
ca<- c1 %>% group_by(BirdID) %>% summarise (Treatment=unique(FlexibilityManipulated))

fo4 <- left_join(fo3,ca,by="BirdID")
fo4 <- subset(fo4, is.na(fo4$Treatment) == FALSE)
#nrow(fo4) #NOTE: n=13 (6=manipulated, 7=control) birds because some dropped out due to not having any foraging events in their focals or not having any focals

# RUN the models
dat_swfo <- list(foodswitches = fo4$totalfoodswitches,
            totaltime = fo4$totaltime, 
            treatment = as.integer(as.factor(fo4$Treatment)) #1=control, 2=manipulated
              )
swfo <- ulam( alist(
        foodswitches ~ dbinom(totaltime,p),
        logit(p) <- a[treatment], #the intercept is the probability of observing any of the types is different between groups, but this probability doesn't change over time (bc birds are observed only AFTER the manipulation is over). Include total observation time because this varied per focal (with a target max time of 10 min)
        a[treatment] ~ dnorm(0,1) #each treatment gets its own intercept, mean=0 bc assume an average bird might show half of the total techs, so 0 on inverse logit = 50%
    ) , data=dat_swfo , chains=4 , cores=4 , cmdstan = TRUE, control = list(adapt_delta = .95, force_recompile = TRUE))

output_swfo <- precis( swfo , depth=2 )
#      mean   sd  5.5% 94.5% n_eff Rhat4
#a[1] -6.60 0.20 -6.94 -6.30  1321     1
#a[2] -5.94 0.16 -6.20 -5.69  1358     1

#contrast to see if treatment groups differ
postswfo <- extract.samples(swfo)
diffswfo <- inv_logit( postswfo$a[,1]) - inv_logit( postswfo$a[,2])
contrast_swfo <- precis( diffswfo )
#         mean   sd  5.5% 94.5%  histogram
#diffswfo    0  0    0     0  ▁▁▁▃▇▃▁▁

#numbers are too small to distinguish, so check the actual intervals...
HPDI(diffswfo) #Highest Posterior Density intervals, which are the same as is used in the precis (described as compatibility intervals) because our samples are from the posterior distribution
#        |0.89         0.89| 
#-0.0020248513 -0.0004803254 
#does not cross zero so the groups differ: manipulated birds have higher probability of switching
#mean(diffswfo) # -0.001279503 per sec
#sd(diffswfo) # 0.0004892852 per sec
#mean(diffswfo)*60 # -0.07677021 per min

# What is the probability that manipulated birds switch techniques per second or minute?
#mean(inv_logit(postswfo$a[,2])) #0.002658024/sec
#mean(inv_logit(postswfo$a[,2]))*60 # 0.1594814/min
# What is the probability that control birds switch techniques per second or minute?
#mean(inv_logit(postswfo$a[,1])) #0.00137852/sec
#mean(inv_logit(postswfo$a[,1]))*60 # 0.08271122/min

# How much more likely are the manipulated birds to switch?
#mean(inv_logit(postswfo$a[,2]))/mean(inv_logit(postswfo$a[,1])) # 1.928172
#sd(inv_logit(postswfo$a[,2]))/mean(inv_logit(postswfo$a[,1])) # 0.3055382
#HPDI(inv_logit(postswfo$a[,2]))/mean(inv_logit(postswfo$a[,1]))
#   |0.89    0.89| 
#1.435329 2.382249 


#TECHNIQUES: count the number of technique switches during each focal
#exclude NAs from the variables in this model
ft2 <- subset(ft1, is.na(ft1$How) == FALSE)
ft2 <- ft2[!ft2$How=="eat",]

ft2$TechSwitch<-NA
ft2[1,]$TechSwitch<-0
for(i in 2:nrow(ft2)){
  ifelse(ft2[i,]$FocalID==ft2[i-1,]$FocalID & ft2[i,]$How !=ft2[i-1,]$How, ft2[i,]$TechSwitch<-1,ft2[i,]$TechSwitch<-0)
}

ft3 <- ft2 %>% group_by(BirdID,FocalID) %>% summarise(switchesperfocal=sum(TechSwitch),timeperfocal=mean(TotalTimeInView))
ft4 <- ft3 %>% group_by(BirdID) %>% summarise(totalswitches=sum(switchesperfocal),totaltime=sum(timeperfocal))

# link with general datasheet to identify which birds were manipulated
c1 <- read.csv(url("https://raw.githubusercontent.com/corinalogan/grackles/master/Files/Preregistrations/g_flexforaging_data_general.csv"), header=T, sep=",", stringsAsFactors=F)
c1 <- data.frame(c1)
#select only the AZ birds who were manipulated or control individuals in the flexibility experiment
c1 <- c1[c1$Population=="AZ",]
ca<- c1 %>% group_by(BirdID) %>% summarise (Treatment=unique(FlexibilityManipulated))

ft5 <- left_join(ft4,ca,by="BirdID")
ft5 <- subset(ft5, is.na(ft5$Treatment) == FALSE)
#nrow(ft5) #NOTE: n=12 (5=manipulated, 7=control) birds because 6 dropped out due to not having any foraging events in their focals or not having any focals

# RUN the models
dat_sw <- list(switches = ft5$totalswitches,
            totaltime = ft5$totaltime, 
            treatment = as.integer(as.factor(ft5$Treatment)) #1=control, 2=manipulated
              )
sw <- ulam( alist(
        switches ~ dbinom(totaltime,p), 
        logit(p) <- a[treatment], #the intercept is the probability of observing any of the techs is different between groups, but this probability doesn't change over time (bc birds are observed only AFTER the manipulation is over). Include total observation time because this varied per focal (with a target max time of 10 min)
        a[treatment] ~ dnorm(0,1) #each treatment gets its own intercept, mean=0 bc assume an average bird might show half of the total techs, so 0 on inverse logit = 50%
    ) , data=dat_sw , chains=4 , cores=4 , cmdstan = TRUE, control = list(adapt_delta = .95, force_recompile = TRUE))

output_sw <- precis( sw , depth=2 )
#      mean   sd  5.5% 94.5% n_eff Rhat4
#a[1] -6.83 0.28 -7.30 -6.41  1316     1
#a[2] -6.29 0.19 -6.61 -5.98  1449     1

#contrast to see if treatment groups differ
postsw <- extract.samples(sw)
diffsw <- inv_logit( postsw$a[,1]) - inv_logit( postsw$a[,2])
contrast_sw <- precis( diffsw )
#         mean   sd  5.5% 94.5%  histogram
#diffsw    0  0    0     0   ▁▁▅▇▅▁▁

#numbers are too small to distinguish, so check the actual intervals...
#HPDI(diffsw) #Highest Posterior Density intervals, which are the same as is used in the precis (described as compatibility intervals) because our samples are from the posterior distribution
#        |0.89         0.89| 
#-1.488057e-03 -1.877975e-05 
#does not cross zero so the groups differ: manipulated birds have higher probability of switching
#mean(diffsw) #-0.000773443
#sd(diffsw) #0.0004663716
#mean(diffsw)*60 #-0.04640658

# What is the probability that manipulated birds switch techniques per second or minute?
#mean(inv_logit(postsw$a[,2])) #0.001888756/sec, 0.1133254/min

# What is the probability that control birds switch techniques per second or minute?
#mean(inv_logit(postsw$a[,1])) #0.001115313/sec, 0.0669188/min

# How much more likely are the manipulated birds to switch?
#mean(inv_logit(postsw$a[,2]))/mean(inv_logit(postsw$a[,1])) # 1.693476
#sd(inv_logit(postsw$a[,2]))/mean(inv_logit(postsw$a[,1])) # 0.3263996
#HPDI(inv_logit(postsw$a[,2]))/mean(inv_logit(postsw$a[,1]))
#   |0.89    0.89| 
#1.187837 2.211168 




# VISUALIZE
#make new variables of probability of switching per minute
fo4$probswitchfo <- (fo4$totalfoodswitches/fo4$totaltime)*60
ft5$probswitch <- (ft5$totalswitches/ft5$totaltime)*60

op <- par(mfrow=c(1,2), mar=c(3,4.9,2,0.9))
plot( as.integer(as.factor(fo4$Treatment))+rnorm(13,0,0.1) , fo4$probswitchfo , xlab="" , ylab="Probability of switching among food types / min" , ylim=c(0,0.3), xlim=c(0.5,2.5), xaxt="n")
points(inv_logit(precis(swfo,depth=2)[1,1])*60 ~ c(1.1),cex=2)
lines(c(inv_logit(precis(swfo,depth=2)[1,3])*60,inv_logit(precis(swfo,depth=2)[1,4])*60) ~ c(1.1,1.1))
points(inv_logit(precis(swfo,depth=2)[2,1])*60 ~ c(1.9),cex=2)
lines(c(inv_logit(precis(swfo,depth=2)[2,3])*60,inv_logit(precis(swfo,depth=2)[2,4])*60) ~ c(1.9,1.9))
mtext("A",side=3,outer=FALSE,adj=0,font=1,cex=1,line=0.2)
mtext("Control",side=1,at=0.9,outer=FALSE,adj=0,font=1,cex=1,line=0.6)
mtext("Manipulated",side=1,at=1.7,outer=FALSE,adj=0,font=1,cex=1,line=0.6)

plot( as.integer(as.factor(ft5$Treatment))+rnorm(12,0,0.1) , ft5$probswitch , xlab="" , ylab="Probabiity of switching among foraging techniques / min" , ylim=c(0,0.3), xlim=c(0.5,2.5), xaxt="n")
points(inv_logit(precis(sw,depth=2)[1,1])*60 ~ c(1.1),cex=2)
lines(c(inv_logit(precis(sw,depth=2)[1,3])*60,inv_logit(precis(sw,depth=2)[1,4])*60) ~ c(1.1,1.1))
points(inv_logit(precis(sw,depth=2)[2,1])*60 ~ c(1.9),cex=2)
lines(c(inv_logit(precis(sw,depth=2)[2,3])*60,inv_logit(precis(sw,depth=2)[2,4])*60) ~ c(1.9,1.9))
mtext("B",side=3,outer=FALSE,adj=0,font=1,cex=1,line=0.2)
mtext("Control",side=1,at=0.9,outer=FALSE,adj=0,font=1,cex=1,line=0.6)
mtext("Manipulated",side=1,at=1.7,outer=FALSE,adj=0,font=1,cex=1,line=0.6)
par(op)
```


![](gxpopbehaviorhabitatFigflexcontrast.png){width=50%}

**Figure 3.** Measures of flexibility from the first reversal of the reversal learning experiment: $\phi$ and $\lambda$ per individual in each population.  The black circles are the raw data from each bird, the blue triangles are the population means, and the blue lines are their 89% compatibility intervals.



## DISCUSSION


It is possible that behavioral flexibility facilitated the increase of this species’ habitat breadth beyond marshes when humans started to modify the environment in central America thousands of years ago [@christensen2000fifteenth]. Great-tailed grackles are now almost exclusively associated with human modified environments [@selander1961analysis, @johnson2001great, @wehtje2003range], and when planning study sites, we initially wanted to compare forest versus urban grackle populations. However, we are unable to find a population that exclusively exists in forests (based on eBird.org data, Logan, pers. obs.). In another article produced from the same preregistration, @logan2020xpop, as the current article, we investigated the role of increased habitat availability in geographic range expansions by comparing rapidly expanding great-tailed grackles with their closest relative that is not rapidly expanding its range, boat-tailed grackles (*Q. major*) [@summers2023xpop]. We predicted that great-tailed grackles expanded their range because suitable habitat (i.e., human modified environments) increased (prediction 1 alternative 1 in the preregistration). Results showed that, between 1979 and 2019, great-tailed grackles increased their habitat breadth to include more urban, arid environments. In contrast, boat-tailed grackles moved into new suitable habitat that was made available by climate change. These results support the possibility that flexibility played a role in the ability to increase habitat breadth. We are currently conducting a behavioral flexibility experiment in boat-tailed grackles to determine whether they are less flexible than great-tailed grackles, which would further support the hypothesis that flexibility was involved in the great-tailed grackle rapid range expansion [in the same preregistration as the current study: @logan2020xpop]. Unfortunately, we discovered in our first boat-tailed grackle field season in 2022 that they do not do well in captivity. Consequently, we will not continue the aviary tests in this species. Therefore, we only have comparable data from the aviary tests for two (reversal), four (multiaccess box), and five (persistence and exploration) individuals. Although the boat-tailed grackle sample size is too small to arrive at robust conclusions, we analyze their data here to give an indication of useful directions for future research. We find that boat-tailed grackles have a **similar flexibility average** as both populations of great-tailed grackles; and boat-tailed grackles are **less innovative** and **less persistent** than both great-tailed grackle populations. Boat-tailed grackles are **less exploratory** than Tempe grackles, while having **similar levels of exploration** as Woodland grackles (see model outputs in Supplementary Material 4). This suggests that we might not find differences in flexibility between the two species. However, we are currently conducting reversal learning experiments in the wild in both species to determine whether this is a robust result [following the hypotheses in the preregistration at @logan2020xpop and methods and analyses in @logan2022manyindividuals].


## DATA, SCRIPT, AND CODE AVAILABILITY

Data, scripts, and code are available online at the Knowledge Network for Biocomplexity’s data repository: <https://doi.org/10.5063/F10C4T7T> [@logan2023xpopdata]. The scripts and code are in the Rmd file, which is also available at https://github.com/corinalogan/grackles/blob/master/Files/Preregistrations/gxpopbehaviorhabitatq1.Rmd

## ETHICS

This research was carried out in accordance with permits from the:

1) US Fish and Wildlife Service (scientific collecting permit number MB76700A-0,1,2)
2) US Geological Survey Bird Banding Laboratory (federal bird banding permit number 23872)
3) Arizona Game and Fish Department (scientific collecting license number SP594338 [2017], SP606267 [2018], SP639866 [2019], and SP402153 [2020])
4) Institutional Animal Care and Use Committee at Arizona State University (protocol number 17-1594R)
5) Institutional Animal Care and Use Committee at the University of California Santa Barbara (protocol number 958)
6) Institutional Animal Care and Use Committee at Archbold Biological Station (protocol number ABS-AUP-033-R)
7) California Department of Fish and Wildlife (scientific collecting permit [specific use] number S‐192100001‐19210‐001)
8) RegionalSan (access permit number AP 2021-01)
9) Florida Fish and Wildlife Conservation Commission (scientific collecting permit number LSSC-21-00050)

# AUTHOR CONTRIBUTIONS

**Logan:** Hypothesis development, data collection (biometrics, focal follows), data analysis and interpretation, write up, revising/editing, materials/funding.

**Lukas:** Hypothesis development, data collection (biometrics), data analysis and interpretation, write up, revising/editing.

# FUNDING

This research was funded by the Department of Human Behavior, Ecology and Culture at the Max Planck Institute for Evolutionary Anthropology.

# CONFLICT OF INTEREST DISCLOSURE

We, the authors, declare that we have no financial conflicts of interest with the content of this article. CJ Logan and D Lukas are Recommenders at PCI Ecology, and CJ Logan used to be on the Managing Board at PCI Ecology (2018-2022).

# ACKNOWLEDGEMENTS

We thank our PCI Ecology recommender, Esther Sebastián González, and reviewers, ??? of the post-study article for their useful feedback, which greatly improved the manuscript. We also thank our pre-study manuscript PCI Ecology recommender, Esther Sebastián González, and reviewers Caroline Marie Jeanne Yvonne Nieberding, Pizza Ka Yee Chow, Tim Parker, and 1 anonymous reviewer for their helpful feedback before the study began. We thank Kristine Johnson for technical advice on great-tailed grackles; Julia Cissewski and Sophie Kaube for tirelessly solving problems involving financial transactions and contracts; Richard McElreath for generously supporting this project; Kelsey McCune for advice throughout the investigation; Sebastian Sosa for advice on how to modify the focal follow protocol for the BTGR; BP and Circle K gas stations for allowing access to their land; the Town of Lake Placid for allowing research access at Lake June Park; Archbold Biological Station and Buck Island Ranch for allowing access to hundreds of acres for grackle research; Reed Bowman and Sahas Barve for hosting this research at Archbold Biological Station; Betsie Rothermel for consultations during difficult times; Joe Guthrie and Emily Angell for helping protect the aviaries from predators; common grackles for enticing the boat-tailed grackles into the trap; boat-tailed grackles for participating in this research; and Brenda Leitner, Robin, and Buddy for great ideas for trap improvement.

# REFERENCES